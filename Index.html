<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FamFrench ‚Äì Web</title>
<style>
  :root { --bg:#0b0b10; --card:#16161e; --text:#eaeaf2; --muted:#a8adbd; --accent:#7cc5ff; }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:880px;margin:0 auto;padding:16px}
  .title{font-weight:700;font-size:1.5rem;text-align:center;margin:10px 0 16px}
  .tabs{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
  .tab{padding:10px 14px;border-radius:999px;background:#1e1e28;color:#cfd3e6;border:1px solid #2a2a36;cursor:pointer}
  .tab.active{background:var(--accent);color:#001b2a;border-color:transparent}
  .card{background:var(--card);border:1px solid #262634;border-radius:14px;padding:14px;margin:10px 0}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px}
  button{background:#242434;border:1px solid #343446;color:#dfe3f9;padding:10px 14px;border-radius:12px;cursor:pointer}
  button:active{transform:translateY(1px)}
  button.tonal{background:#1d2a3a;border-color:#29455e}
  button.primary{background:var(--accent);color:#001b2a;border-color:transparent}
  .muted{color:var(--muted)}
  .score{font-weight:600}
  .lesson{font-size:1.05rem;font-weight:600;margin-bottom:6px}
  .fr{font-weight:700;font-size:1.1rem}
  .en{color:#b7bdd0}
  .hint{color:#9aa3b7;font-size:.9rem}
  .divider{height:1px;background:#262634;margin:10px 0}
  .small{font-size:.9rem}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#283141;color:#a6ceff;border:1px solid #3a4960;font-size:.8rem;margin-left:6px}
  .footer{opacity:.8;font-size:.85rem;text-align:center;margin-top:14px}
</style>
</head>
<body>
<div class="wrap">
  <div class="title">FamFrench ‚Äì Lockeres Franz√∂sisch f√ºr Familie & Freunde</div>
  <div class="tabs">
    <div class="tab active" data-tab="today">Heute</div>
    <div class="tab" data-tab="lessons">Lektionen</div>
    <div class="tab" data-tab="practice">√úben</div>
  </div>
  <div id="screen"></div>
  <div class="footer">Alles lokal im Browser. TTS & Spracheingabe: <span class="muted">fr-FR</span>. Keine Daten√ºbertragung.</div>
</div>

<script>
// ---------------- Content ----------------
const Week1 = [
  { name: "Lektion 1 ‚Äì Begr√º√üen & Smalltalk", phrases: [
    {fr:"Salut !", en:"Hi!", hint:"sa-LOO", who:"A"},
    {fr:"Coucou !", en:"Hey there!", hint:"koo-KOO", who:"B"},
    {fr:"√áa va ?", en:"How are you?", hint:"sa VAH", who:"A"},
    {fr:"√áa va, et toi ?", en:"I‚Äôm good, and you?", hint:"sa VAH, eh TWAH", who:"B"},
    {fr:"√Ä plus !", en:"See you!", hint:"ah PLOOSE", who:"A"},
  ]},
  { name: "Lektion 2 ‚Äì Familie & N√§he", phrases: [
    {fr:"Tu vas bien ?", en:"You doing okay?", hint:"tu vah BYAN", who:"A"},
    {fr:"On se voit ce week-end ?", en:"See you this weekend?", hint:"ohn suh vwah suh week-END", who:"B"},
    {fr:"Je suis content de te voir.", en:"I‚Äôm happy to see you.", hint:"zhuh swee kon-TAHN duh tuh vwar", who:"A"},
    {fr:"Fais comme chez toi.", en:"Make yourself at home.", hint:"feh kom shay TWA", who:"B"},
  ]},
  { name: "Lektion 3 ‚Äì Bitten & Danken", phrases: [
    {fr:"S‚Äôil te pla√Æt.", en:"Please.", hint:"seel tuh PLEH", who:"A"},
    {fr:"Merci !", en:"Thanks!", hint:"mehr-SEE", who:"B"},
    {fr:"Merci beaucoup.", en:"Thank you very much.", hint:"mehr-SEE boh-KOO", who:"A"},
    {fr:"Pas de souci.", en:"No worries.", hint:"pah duh soo-SEE", who:"B"},
  ]},
  { name: "Lektion 4 ‚Äì Langsamer / Nochmal", phrases: [
    {fr:"Tu peux r√©p√©ter, s‚Äôil te pla√Æt ?", en:"Can you repeat, please?", hint:"tu puh ray-peh-TAY, seel tuh PLEH", who:"A"},
    {fr:"Encore une fois.", en:"One more time.", hint:"ahn-KOR uhn FWAH", who:"B"},
    {fr:"Plus lentement, s‚Äôil te pla√Æt.", en:"More slowly, please.", hint:"ploo lon-te-MON, seel tuh PLEH", who:"A"},
  ]},
];
const allPhrases = Week1.flatMap(l => l.phrases);

// --- Utilities ---
function lev(a,b){
  a=a.toLowerCase(); b=b.toLowerCase();
  const dp=Array(a.length+1).fill(0).map(()=>Array(b.length+1).fill(0));
  for(let i=0;i<=a.length;i++) dp[i][0]=i;
  for(let j=0;j<=b.length;j++) dp[0][j]=j;
  for(let i=1;i<=a.length;i++){
    for(let j=1;j<=b.length;j++){
      const cost = a[i-1]===b[j-1]?0:1;
      dp[i][j]=Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+cost);
    }
  }
  return dp[a.length][b.length];
}
function norm(s){
  return (s||"").toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-zA-Z≈ì√ß√†√¢√§√©√®√™√´√Æ√Ø√¥√∂√π√ª√º\s]/g,"")
    .replace(/\s+/g," ").trim();
}
function similarity(a,b){
  const x=norm(a), y=norm(b);
  if(!x && !y) return 1;
  const d=lev(x,y); return 1 - d/Math.max(x.length,y.length);
}

// --- TTS ---
let frVoice=null;
function initVoices(){
  frVoice = speechSynthesis.getVoices().find(v => /fr/i.test(v.lang)) || null;
}
speechSynthesis.onvoiceschanged = initVoices;
initVoices();
function speak(text, rate=1.0){
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "fr-FR";
  if(frVoice) u.voice = frVoice;
  u.rate = rate;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

// --- STT ---
function recordOnce(onResult){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){ alert("Spracherkennung nicht verf√ºgbar (Browser)."); return; }
  const r = new SR();
  r.lang = "fr-FR"; r.interimResults = false; r.maxAlternatives = 1;
  r.onresult = (e)=>{ onResult(e.results?.[0]?.[0]?.transcript || ""); };
  r.start();
}

// --- UI ---
const screen=document.getElementById('screen');
document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click', ()=>{
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  if(t.dataset.tab==='today') renderToday();
  if(t.dataset.tab==='lessons') renderLessons();
  if(t.dataset.tab==='practice') renderPractice();
}));
function renderToday(){
  const sample=[...allPhrases].sort(()=>Math.random()-0.5).slice(0,8);
  screen.innerHTML=`<div class="card"><div class="lesson">Heute (8 Karten)</div>
    ${sample.map(p=>phraseCard(p)).join('')}
  </div>`;
  attachHandlers();
}
function renderLessons(){
  screen.innerHTML = Week1.map(lesson=>`
    <div class="card">
      <div class="lesson">${lesson.name}</div>
      ${lesson.phrases.map(p=>phraseCard(p)).join('')}
    </div>`).join('');
  attachHandlers();
}
function renderPractice(){
  screen.innerHTML=`<div class="card"><div class="lesson">Alle Phrasen</div>
    ${allPhrases.map(p=>phraseCard(p)).join('')}
  </div>`;
  attachHandlers();
}
function phraseCard(p){
  const id=Math.random().toString(36).slice(2);
  return `<div class="divider"></div>
    <div class="fr">${p.fr}</div>
    <div class="en">${p.en}</div>
    <div class="hint">Aussprache: ${p.hint}</div>
    <div class="row">
      <button class="play" data-id="${id}" data-rate="1">‚ñ∂Ô∏é Abspielen</button>
      <button class="play tonal" data-id="${id}" data-rate="0.7">‚èµ Langsam</button>
      <button class="primary speak" data-id="${id}">üé§ Nachsprechen</button>
    </div>
    <div class="row small"><span class="muted">Erkannt:</span> <span id="rec-${id}" class="muted"></span></div>
    <div class="row small"><span class="muted">Treffer:</span> <span id="sc-${id}" class="score">‚Äì</span></div>
    <input type="hidden" id="txt-${id}" value="${p.fr}">`;
}
function attachHandlers(){
  document.querySelectorAll('button.play').forEach(b=>{
    b.onclick=()=>{
      const id=b.dataset.id;
      const rate=parseFloat(b.dataset.rate||"1");
      const text=document.getElementById('txt-'+id).value;
      speak(text,rate);
    };
  });
  document.querySelectorAll('button.speak').forEach(b=>{
    b.onclick=()=>{
      const id=b.dataset.id;
      const target=document.getElementById('txt-'+id).value;
      recordOnce(rec=>{
        document.getElementById('rec-'+id).textContent=`"${rec}"`;
        const s=Math.round(similarity(target,rec)*100);
        const label=s>=85?"Super":s>=70?"Gut":"Nochmal";
        document.getElementById('sc-'+id).textContent=`${s}% ‚Äì ${label}`;
      });
    };
  });
}
renderToday();
</script>
</body>
</html>
