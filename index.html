<!doctype html>

<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FamLang – Français uniquement</title>
  <style>
    :root{ --bg:#0f1115;--fg:#e8ebf0;--muted:#9aa3b2;--card:#151822;--accent:#5aa9ff;--chip:#232738;--ring:#2b3246;--ok:#45d483;--warn:#f5b942;--danger:#ff7676; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .wrap{max-width:980px;margin:24px auto;padding:0 16px}
    header h1{margin:0 0 6px;font-weight:800;letter-spacing:.3px}
    header p{margin:4px 0;color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .chip{background:var(--chip);border:1px solid var(--ring);padding:8px 10px;border-radius:999px;font-size:.9rem}
    .card{background:var(--card);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 2px 6px rgba(0,0,0,.35)}
    h2{margin:0 0 10px}
    textarea{width:100%;min-height:110px;background:#0c0f16;color:var(--fg);border:1px solid var(--ring);border-radius:12px;padding:10px}
    input, select{background:#0c0f16;color:var(--fg);border:1px solid var(--ring);border-radius:10px;padding:10px}
    button{background:var(--accent);color:#041023;border:0;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;color:var(--fg);border:1px solid var(--ring)}
    button:disabled{opacity:.6;cursor:not-allowed}
    .ok{color:var(--ok);font-weight:700}
    .warn{color:var(--warn);font-weight:700}
    .danger{color:var(--danger);font-weight:700}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
    .phrase{border:1px solid var(--ring);border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px}
    .meta{display:flex;gap:8px;flex-wrap:wrap}
    .meta .tag{border:1px solid var(--ring);border-radius:999px;padding:4px 8px;font-size:.8rem;color:var(--muted)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .fav{filter:grayscale(1);opacity:.85}
    .fav.active{filter:none}
    .sr{position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0 0 0 0)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>FamLang</h1>
      <p>Informell, familiär – <strong>Français uniquement</strong> (NL supprimé)</p>
      <div class="row" style="margin-top:6px">
        <span class="chip">FR actif</span>
        <span class="chip" id="ttsState">TTS : vérification…</span>
        <label class="chip" for="voiceSelect">Voix TTS
          <select id="voiceSelect" style="margin-left:8px"></select>
        </label>
        <label class="chip" for="rate">Vitesse
          <input id="rate" type="range" min="0.7" max="1.4" step="0.05" value="1" style="width:120px;vertical-align:middle;margin-left:8px"/>
        </label>
      </div>
      <div class="row" style="margin-top:10px">
        <input id="search" placeholder="Rechercher une phrase… (ex. clé, dîner)" style="flex:1" />
        <select id="filterCat">
          <option value="">Catégorie : toutes</option>
        </select>
        <button id="randomBtn" class="ghost">Aléatoire</button>
      </div>
    </header><div class="card">
  <h2>Phrases utiles (famille & quotidien)</h2>
  <div id="list" class="grid" aria-live="polite"></div>
  <div id="emptyMsg" class="warn" style="display:none;margin-top:8px">Aucun résultat. Essaie un autre mot-clé ou une autre catégorie.</div>
</div>

<div class="card">
  <h2>Favoris</h2>
  <div id="favs" class="grid"></div>
  <div id="noFavs" class="muted" style="color:var(--muted)">Aucun favori pour l’instant. Appuie sur ★ pour en ajouter.</div>
</div>

<div class="card">
  <h2>Bloc‑notes</h2>
  <p>Note tes phrases personnelles à pratiquer :</p>
  <textarea id="notes" placeholder="Écris ici…"></textarea>
  <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
    <button id="saveBtn">Enregistrer</button>
    <span id="status" class="ok" aria-live="polite"></span>
  </div>
</div>

  </div>  <script>
    // ===== Données (FR uniquement) =====
    const DATA = [
      { id:1, fr:"Tu peux m’aider, s’il te plaît ?", cat:["aide","famille"], hint:"polie" },
      { id:2, fr:"On mange à quelle heure ?", cat:["maison","repas"] },
      { id:3, fr:"Où as‑tu mis les clés ?", cat:["maison","objets"] },
      { id:4, fr:"Je reviens tout de suite.", cat:["quotidien"] },
      { id:5, fr:"Bonne nuit, à demain !", cat:["famille","salutations"] },
      { id:6, fr:"Qui veut un café ?", cat:["cuisine","famille"] },
      { id:7, fr:"Peux‑tu baisser le volume ?", cat:["maison","tech"] },
      { id:8, fr:"Je m’en occupe.", cat:["travail","quotidien"] },
      { id:9, fr:"N’oublie pas ton sac, s’il te plaît.", cat:["famille","objets"] },
      { id:10, fr:"On part dans cinq minutes.", cat:["déplacements","famille"] },
      { id:11, fr:"Qui met la table aujourd’hui ?", cat:["maison","repas"] },
      { id:12, fr:"Peux‑tu vérifier la porte ?", cat:["maison","sécurité"] },
      { id:13, fr:"Je suis presque prêt(e).", cat:["déplacements"] },
      { id:14, fr:"Tu veux que je t’explique ?", cat:["aide","école"] },
      { id:15, fr:"On fait une pause ?", cat:["loisirs","travail"] },
    ];

    const qs = sel => document.querySelector(sel);
    const list = qs('#list');
    const favsEl = qs('#favs');
    const noFavs = qs('#noFavs');
    const search = qs('#search');
    const filterCat = qs('#filterCat');
    const randomBtn = qs('#randomBtn');
    const notes = qs('#notes');
    const status = qs('#status');
    const saveBtn = qs('#saveBtn');
    const voiceSelect = qs('#voiceSelect');
    const rate = qs('#rate');
    const ttsState = qs('#ttsState');

    const LS_KEYS = {
      favs: 'famlang_fr_favs_v1',
      notes: 'famlang_fr_notes_v1',
      voice: 'famlang_fr_voice',
      rate:  'famlang_fr_rate',
    };

    // ===== TTS (FR only) =====
    let voices = [];
    function loadVoices() {
      voices = window.speechSynthesis ? speechSynthesis.getVoices().filter(v => v.lang && v.lang.toLowerCase().startsWith('fr')) : [];
      voiceSelect.innerHTML = '';
      if (!voices.length) {
        const opt = document.createElement('option');
        opt.textContent = 'Aucune voix FR trouvée';
        opt.value = '';
        voiceSelect.appendChild(opt);
        ttsState.textContent = 'TTS : voix FR manquante (installe Google/Samsung FR)';
        return;
      }
      voices.forEach((v,i)=>{
        const o = document.createElement('option');
        o.value = v.name; o.textContent = `${v.name} (${v.lang})`;
        voiceSelect.appendChild(o);
      });
      const saved = localStorage.getItem(LS_KEYS.voice);
      if (saved) voiceSelect.value = saved;
      ttsState.textContent = 'TTS prêt';
    }
    if ('speechSynthesis' in window) {
      speechSynthesis.onvoiceschanged = loadVoices;
      setTimeout(loadVoices, 100);
    } else {
      ttsState.textContent = 'TTS non supporté';
    }

    function speak(text){
      if(!('speechSynthesis' in window)) return;
      const u = new SpeechSynthesisUtterance(text);
      const name = voiceSelect.value;
      const v = voices.find(x=>x.name===name) || voices[0];
      if (v) u.voice = v;
      const r = parseFloat(rate.value || '1');
      u.rate = isNaN(r)?1:r;
      u.lang = (v && v.lang) || 'fr-FR';
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }

    voiceSelect.addEventListener('change', ()=>{
      localStorage.setItem(LS_KEYS.voice, voiceSelect.value);
    });
    rate.addEventListener('change', ()=>{
      localStorage.setItem(LS_KEYS.rate, rate.value);
    });

    // restore rate
    const savedRate = localStorage.getItem(LS_KEYS.rate);
    if (savedRate) rate.value = savedRate;

    // ===== Favoris =====
    function getFavs(){
      try { return JSON.parse(localStorage.getItem(LS_KEYS.favs)||'[]'); } catch(e){ return []; }
    }
    function setFavs(arr){ localStorage.setItem(LS_KEYS.favs, JSON.stringify(arr)); }
    function toggleFav(id){
      const favs = new Set(getFavs());
      if (favs.has(id)) favs.delete(id); else favs.add(id);
      setFavs([...favs]);
      render();
    }

    // ===== Rendu =====
    function tag(t){ return `<span class="tag">#${t}</span>`; }
    function card(item){
      const favSet = new Set(getFavs());
      const isFav = favSet.has(item.id);
      return `
        <div class="phrase" data-id="${item.id}">
          <div style="display:flex;justify-content:space-between;gap:8px;align-items:flex-start">
            <div style="font-size:1.05rem;line-height:1.35">${item.fr}</div>
            <button class="ghost fav ${isFav?'active':''}" title="Ajouter aux favoris" data-action="fav">${isFav?'★':'☆'}</button>
          </div>
          <div class="meta">${(item.cat||[]).map(tag).join(' ')}${item.hint?`<span class="tag">${item.hint}</span>`:''}</div>
          <div class="actions">
            <button data-action="speak">▶️ Lire</button>
            <button class="ghost" data-action="copy">Copier</button>
          </div>
        </div>`;
    }

    function render(){
      const q = search.value.trim().toLowerCase();
      const c = filterCat.value;
      const filtered = DATA.filter(x => (!q || x.fr.toLowerCase().includes(q)) && (!c || x.cat?.includes(c)));
      list.innerHTML = filtered.map(card).join('');
      qs('#emptyMsg').style.display = filtered.length? 'none':'block';

      // Favoris
      const favSet = new Set(getFavs());
      const favItems = DATA.filter(x=>favSet.has(x.id));
      favsEl.innerHTML = favItems.length ? favItems.map(card).join('') : '';
      noFavs.style.display = favItems.length ? 'none':'block';
    }

    // Build categories
    [...new Set(DATA.flatMap(d=>d.cat||[]))].sort().forEach(c=>{
      const o=document.createElement('option'); o.value=c; o.textContent=c; filterCat.appendChild(o);
    });

    // Events
    search.addEventListener('input', render);
    filterCat.addEventListener('change', render);
    randomBtn.addEventListener('click', ()=>{
      const item = DATA[Math.floor(Math.random()*DATA.length)];
      speak(item.fr);
    });

    list.addEventListener('click', (e)=>{
      const root = e.target.closest('.phrase');
      if (!root) return;
      const id = parseInt(root.dataset.id,10);
      const action = e.target.getAttribute('data-action');
      const item = DATA.find(x=>x.id===id);
      if (action==='speak') speak(item.fr);
      if (action==='copy') {
        navigator.clipboard?.writeText(item.fr);
        e.target.textContent='Copié'; setTimeout(()=> e.target.textContent='Copier', 900);
      }
      if (action==='fav') toggleFav(id);
    });

    favsEl.addEventListener('click', (e)=>{
      const root = e.target.closest('.phrase');
      if (!root) return;
      const id = parseInt(root.dataset.id,10);
      const action = e.target.getAttribute('data-action');
      const item = DATA.find(x=>x.id===id);
      if (action==='speak') speak(item.fr);
      if (action==='copy') {
        navigator.clipboard?.writeText(item.fr);
        e.target.textContent='Copié'; setTimeout(()=> e.target.textContent='Copier', 900);
      }
      if (action==='fav') toggleFav(id);
    });

    // Notes
    try { notes.value = localStorage.getItem(LS_KEYS.notes) || ''; } catch(e){}
    saveBtn.addEventListener('click', ()=>{
      try { localStorage.setItem(LS_KEYS.notes, notes.value); status.textContent='Enregistré'; setTimeout(()=> status.textContent='', 1500); } catch(e){ status.textContent='Échec'; }
    });

    render();
  </script></body>
</html>
