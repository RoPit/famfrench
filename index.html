<!doctype html>

<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FamLang â€“ informell, familiÃ¤r (FR â‡„ NL)</title>
  <style>
    :root{
      --bg:#0f1115;--fg:#e8ebf0;--muted:#9aa3b2;--card:#151822;--accent:#5aa9ff;--chip:#232738;--ring:#2b3246;--ok:#45d483;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .wrap{max-width:980px;margin:24px auto;padding:0 16px}
    header h1{margin:0 0 6px;font-weight:800;letter-spacing:.3px}
    header p{margin:4px 0 0;color:var(--muted)}
    .bar{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;margin:18px 0}
    .search{display:flex;gap:8px;align-items:center;background:var(--card);border:1px solid var(--ring);border-radius:14px;padding:10px 12px}
    .search input{flex:1;background:transparent;border:0;outline:none;color:var(--fg);font-size:16px}
    .filters{display:flex;gap:8px;flex-wrap:wrap}
    select,button{background:var(--chip);color:var(--fg);border:1px solid var(--ring);border-radius:14px;padding:10px 12px;font-size:14px;cursor:pointer}
    button[aria-pressed="true"]{outline:2px solid var(--accent)}
    .flags{display:flex;gap:8px}
    .flag{width:34px;height:24px;border-radius:6px;border:1px solid var(--ring);cursor:pointer;opacity:.75}
    .flag.active{outline:2px solid var(--ok);opacity:1}
    .grid{display:grid;grid-template-columns:1fr;gap:10px;margin:16px 0 36px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:14px 14px}
    .cat{display:inline-flex;gap:6px;align-items:center;background:var(--chip);border:1px solid var(--ring);border-radius:999px;padding:4px 10px;font-size:12px;color:var(--muted)}
    .row{display:flex;gap:10px;align-items:flex-start;justify-content:space-between}
    .txt-main{font-size:18px;margin:6px 0 2px;font-weight:700;cursor:pointer}
    .txt-sub{font-size:16px;margin:2px 0;color:#d7dbef}
    .txt-de{font-size:13px;margin:8px 0 0;color:var(--muted)}
    .empty{margin:24px 0;color:var(--muted)}
    footer{color:var(--muted);font-size:12px;margin:20px 0 40px}
    .pill{background:var(--chip);border:1px solid var(--ring);border-radius:999px;padding:6px 12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>FamLang â€“ informell, familiÃ¤r <small style="font-weight:500;color:var(--muted)">(FR â‡„ NL)</small></h1>
      <p>Klicke ðŸ‡«ðŸ‡· oder ðŸ‡³ðŸ‡± â€“ die App zeigt & spricht die gewÃ¤hlte Sprache. Alles lÃ¤uft als Einzeldatei und ist GitHubâ€‘Pagesâ€‘sicher (keine fÃ¼hrenden Slashes).</p>
    </header><div class="bar">
  <div class="search" role="search">
    <input id="q" type="search" placeholder="Suche (FR/NL/DE)â€¦" autocomplete="off" />
  </div>
  <div class="flags" aria-label="Sprachauswahl">
    <img id="flag-fr" class="flag" alt="FR" title="FranzÃ¶sisch als Hauptsprache" />
    <img id="flag-nl" class="flag" alt="NL" title="NiederlÃ¤ndisch als Hauptsprache" />
  </div>
</div>

<div class="filters">
  <select id="category">
    <option value="">Alle Kategorien</option>
  </select>
  <button id="show-today" class="pill" aria-pressed="true">Heute</button>
  <button id="show-all" class="pill" aria-pressed="false">Alle</button>
  <button id="show-packs" class="pill" aria-pressed="false">Packs</button>
</div>

<div id="results" class="grid" aria-live="polite"></div>
<div id="empty" class="empty" hidden>Keine EintrÃ¤ge gefunden.</div>

<footer>
  <div>Hinweis: Manifest & JSON werden relativ zur aktuellen Seite geladen.<br>Wenn dein Repo <code>/data</code> enthÃ¤lt, trage die Dateien in <code>manifest.json</code> ein (ohne fÃ¼hrenden Slash).</div>
</footer>

  </div><script>
(() => {
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const BASE = new URL('./', window.location.href);
  const urlFor = (p) => new URL(p, BASE).toString();
  const fetchJson = async (p) => { const res = await fetch(urlFor(p), { cache: 'no-store' }); if (!res.ok) throw new Error(`Fetch failed ${p}: ${res.status}`); return res.json(); };

  const state = { primary:'fr', secondary:'nl', show:'today', category:'', q:'', items:[], categories:new Set() };

  const svgFR='data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3 2"><rect width="1" height="2" fill="#0055A4"/><rect width="1" height="2" x="1" fill="#fff"/><rect width="1" height="2" x="2" fill="#EF4135"/></svg>`);
  const svgNL='data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3 2"><rect width="3" height="2" fill="#21468B"/><rect width="3" height="1.333" y="0.333" fill="#fff"/><rect width="3" height="0.666" y="0" fill="#AE1C28"/></svg>`);
  $('#flag-fr').src=svgFR; $('#flag-nl').src=svgNL;

  $('#flag-fr').addEventListener('click',()=>setLang('fr','nl'));
  $('#flag-nl').addEventListener('click',()=>setLang('nl','fr'));
  $('#q').addEventListener('input',(e)=>{state.q=e.target.value.trim().toLowerCase();render();});
  $('#category').addEventListener('change',(e)=>{state.category=e.target.value;render();});
  $('#show-today').addEventListener('click',()=>setShow('today'));
  $('#show-all').addEventListener('click',()=>setShow('all'));
  $('#show-packs').addEventListener('click',()=>setShow('packs'));

  function setShow(mode){
    state.show = mode;
    $('#show-today').setAttribute('aria-pressed', mode==='today');
    $('#show-all').setAttribute('aria-pressed', mode==='all');
    $('#show-packs').setAttribute('aria-pressed', mode==='packs');
    render();
  }catch(err){showError(err);} }

  function guessCategory(path){ return (path.split('/').pop()||'').replace(/_/g,' ').replace(/\..+$/,''); }
  function buildCategorySelect(){ const sel=$('#category'); const current=sel.value; sel.innerHTML='<option value="">Alle Kategorien</option>'+Array.from(state.categories).sort().map(c=>`<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join(''); sel.value=current||''; }

  function render(){
    const list=$('#results'); const empty=$('#empty'); list.innerHTML='';
    let view=state.items.slice();
    if(state.category) view=view.filter(x=>x.category===state.category);
    if(state.q){ const q=state.q; view=view.filter(x=>(x.fr.toLowerCase().includes(q)||x.nl.toLowerCase().includes(q)||x.de.toLowerCase().includes(q)||x.hint.toLowerCase().includes(q))); }
    if(state.show==='today'){ const today=new Date().toDateString(); view=view.filter(x=>new Date(x.ts).toDateString()===today); }
    if(!view.length){ empty.hidden=false; return; } else { empty.hidden=true; }
    const frag=document.createDocumentFragment();
    for(const item of view){
      const card=document.createElement('div'); card.className='card';
      card.innerHTML=`
        <div class="row"><span class="cat">${escapeHtml(item.category)}</span><span class="cat">${escapeHtml(item.pack.split('/').pop())}</span></div>
        <div class="txt-main" data-say="${escapeHtml(item[state.primary]||'')}">${escapeHtml(item[state.primary]||'')}</div>
        <div class="txt-sub">${escapeHtml(item[state.secondary]||'')}</div>
        <div class="txt-de">${escapeHtml(item.de||'')}${item.hint?' Â· <em>Hint: '+escapeHtml(item.hint)+'</em>':''}</div>`;
      frag.appendChild(card);
    }
    list.appendChild(frag);
    // attach TTS events
    $$('.txt-main',list).forEach(el=>el.addEventListener('click',()=>speak(el.dataset.say,state.primary)));
  }

  function speak(text,lang){ if(!text) return; const u=new SpeechSynthesisUtterance(text); u.lang=lang==='fr'?'fr-FR':'nl-NL'; speechSynthesis.speak(u); }

  function escapeHtml(s){ return s.replace(/[&<>\"]/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[ch])); }
  function showError(err){ $('#empty').hidden=false; $('#empty').textContent='Fehler beim Laden: '+(err?.message||err); console.error(err); }

  setLang('fr','nl'); loadAll();
})();
</script></body>
</html>
